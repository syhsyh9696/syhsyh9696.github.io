---
layout: post
title: "Javlibrary Spider"
date: 2017-04-11 09:16:48 +0800
categories:
tags:
- Ruby
categories:
- SYH的自留地
---

**关怀宅男企划[0]**

春天到了，空气弥漫的荷尔蒙的味道，这让宅男怎么办？
所以，开始一个新的企划,就来扒Javlibrary吧。

利用Gem 
- Nokogiri
- Rest-client 

一开始我只是闲的无聊的时候再翻友田桑的作品，我发现我不能一次性获得
她所有的影片信息，这很不爽啊是不是！通过观察发现，我从页面中发现一个
href能成功获得最后一页的页码，提取出来之后用obj#upto方法迭代，拿到了
左右影片的网站内部编码。

然后获得了一个能获得大姐姐所有作品的方法，然后下一步就是获得所有大姐姐
的名字和编码，Javlibrary提供了名册这个href。

拿到所有的名字，方法同上，拿到最后的页码然后解析，不过这次是两次迭代，
迭代26个字母和页码。这样你就获得了所有大姐姐名字的方法。

两者结合，你就拥有了带名字的所有影片编码，当然多体作品是同时拥有很多
演员，也就是说里面的编码很多都是重复的，没关系我们可以先不用管，放到
数据库阶段处理。

根据编号你就可以请求Javlibrary的影片信息了，嗯，很爽，分析页面能拿到
演员导演时间番号长度balabala，你可以先保存成文件，方便多线程。

最后的最后，就是插数据库了，多线程插入的速度比单线程不知道高到哪里去了，
主要解决的问题就是正确的给一个地址+偏移量，数据库的设计还是Jango完成的。

做完这些做了一个小小的bot用于开车，[@ujnlaosijibot](http://telegram.me/ujnlaosijibot)

如果你能看懂的话，仓库在[这里](http://www.github.com/syhsyh9696/javlibrary-spider)

当然最后的sql在[这里](https://pan.baidu.com/s/1bprexx9)

最后祝你，身体健康，再见。





